<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Your Cart</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
	<style>
		body {
			background-color: #f5f9fb;
		}

		.cart-table th,
		.cart-table td {
			vertical-align: middle;
			text-align: center;
		}

		.btn-danger {
			background-color: #ff4d4d;
			border: none;
		}

		.btn-danger:hover {
			background-color: #cc0000;
		}

		.total-box {
			background-color: #fff;
			padding: 25px;
			border-radius: 8px;
			border: 1px solid #dee2e6;
		}

		.alert-success {
			background-color: #d1e7dd;
			color: #0f5132;
			border: 1px solid #badbcc;
		}
	</style>
</head>

<body>

	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<div class="container-fluid">
			<a class="navbar-brand" th:href="@{/user/home(mobile=${mobile})}">Grocery Store</a>
			<div class="d-flex">
				<a class="btn btn-outline-light" th:href="@{/user/cart(mobile=${mobile})}">
					ðŸ›’ Cart (<span th:text="${cartItems.size()}"></span>)
				</a>
			</div>
		</div>
	</nav>

	<div class="container mt-4">
		<h3 class="mb-4">Shopping Cart</h3>

		<!-- âœ… Order Confirmation Message -->
		<div th:if="${orderConfirmed}" class="alert alert-success text-center">
			<i class="bi bi-check-circle-fill"></i> Your order has been <strong>confirmed</strong>! Youâ€™ll be notified shortly.
		</div>

		<div th:if="${cartItems.size() == 0}">
			<p>Your cart is empty.</p>
			<a class="btn btn-primary" th:href="@{/user/home(mobile=${mobile})}">Continue Shopping</a>
		</div>

		<div th:if="${cartItems.size() > 0}">
			<form th:action="@{/user/cart/updateQuantity}" method="post">
				<input type="hidden" name="mobile" th:value="${mobile}" />
				<div class="shadow p-4 bg-white rounded">
					<table class="table cart-table">
						<thead class="table-light">
							<tr>
								<th>Image</th>
								<th>Item</th>
								<th>Price</th>
								<th>Quantity</th>
								<th>Subtotal</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="item : ${cartItems}">
								<td>
									<img th:src="@{'/GroceryWeb/uploads/groceries/' + ${item.groceryItem.image}}"
										class="card-img-top" style="width:80px">
								</td>
								<td th:text="${item.groceryItem.name}">Item Name</td>
								<td>â‚¹ <span th:text="${item.groceryItem.price}">0.00</span></td>
								<td>
									<input type="hidden" name="cartId" th:value="${item.id}" />
									<input type="number" name="quantity" th:value="${item.quantity}" min="1"
										class="form-control text-center" style="width: 80px;" />
								</td>
								<td>
									â‚¹ <span th:text="${item.groceryItem.price * item.quantity}">0.00</span>
								</td>
								<td>
									<a th:href="@{/user/cart/remove(id=${item.id}, mobile=${mobile})}" class="btn btn-sm">
										<i class="fa-regular fa-trash-can text-white bg-danger fs-6 p-2"></i>
									</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Update Button -->
				<div class="row m-4">
					<div class="col-md-12 text-end">
						<button type="submit" class="btn btn-success">Update Cart</button>
					</div>
				</div>
			</form>

			<!-- Order Summary Section -->
			<div class="m-4">
				<div class="col-lg-6 offset-lg-6">
					<h4 class="mb-3 text-uppercase">Order Summary</h4>
					<div class="border p-4 bg-white rounded shadow">

						<div class="d-flex justify-content-between mb-3">
							<span><i class="bi bi-receipt"></i> Subtotal</span>
							<span>â‚¹ <span th:text="${totalPrice}">0.00</span></span>
						</div>

						<!-- Payment Options -->
						<div class="mb-4">
							<strong class="d-block mb-2"><i class="bi bi-credit-card-2-front"></i> Select Payment Method</strong>
							<div class="form-check">
								<input class="form-check-input" type="radio" name="paymentMethod" id="onlinePayment" checked>
								<label class="form-check-label" for="onlinePayment">
									<i class="bi bi-globe"></i> Online Payment (UPI / Netbanking / Card)
								</label>
							</div>
							<div class="form-check mt-2">
								<input class="form-check-input" type="radio" name="paymentMethod" id="cod">
								<label class="form-check-label" for="cod">
									<i class="bi bi-wallet2"></i> Cash on Delivery (COD)
								</label>
							</div>
						</div>

						<!-- Total -->
						<hr>
						<div class="d-flex justify-content-between fs-5 fw-semibold">
							<span><i class="bi bi-cash-coin"></i> Total</span>
							<span>â‚¹ <span th:text="${totalPrice}">0.00</span></span>
						</div>

						<!-- âœ… Checkout Button as Form -->
						<div class="mt-4 text-center">
							<form th:action="@{/user/checkout}" method="post">
								<input type="hidden" name="mobile" th:value="${session.loginUser.mobile}" />
								<button type="submit" class="btn btn-success btn-lg w-100">
									<i class="bi bi-check-circle-fill"></i> Proceed to Checkout
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>

</body>

</html>
